import re

def parse_statistics(text):
    lines = text.splitlines()
    result = {}

    total_time = ""
    experience = 0

    items_section = False
    for line in lines:
        line = line.strip()
        if line.startswith("Статистика за"):
            # Используем регулярное выражение для извлечения времени
            time_match = re.search(r'(\d+)\s*дн?\s*(\d+)\s*ч\s*(\d+)\s*мин|(\d+)\s*ч\s*(\d+)\s*мин', line)
            if time_match:
                if time_match.group(1):  # Если указаны дни
                    days = int(time_match.group(1))
                    hours = int(time_match.group(2))
                    minutes = int(time_match.group(3))
                else:  # Только часы и минуты
                    days = 0
                    hours = int(time_match.group(4))  # Извлечение часов
                    minutes = int(time_match.group(5))  # Извлечение минут

                total_time = f"{days} дн. {hours} ч. {minutes} мин."
            continue
        if "Получено опыта:" in line:
            experience = int(line.split(":")[1].strip())
            continue
        if line.startswith("Найдены вещи:"):
            items_section = True
            continue
        if items_section:
            if not line:
                break
            parts = line.rsplit("(", 1)
            if len(parts) == 2:
                key = parts[0].strip()
                value = parts[1].strip().rstrip(" шт.)")
                result[key] = int(value)
            else:
                key = line.strip()
                result[key] = 1
        else:
            if "Выбито с ботов:" in line:
                key, value = line.split(":", 1)
                result[key.strip()] = int(value.split()[0])

    return result, total_time, experience

def calculate_total(statistics, prices):
    total_sum = 0

    # Считаем сумму за "Выбито с ботов"
    if "Выбито с ботов" in statistics:
        total_sum += statistics["Выбито с ботов"]

    # Считаем сумму для остальных предметов, пропуская "Клык"
    for item, quantity in statistics.items():
        if item in prices and item != "Клык":  # Пропускаем "Клык"
            total_sum += quantity * prices[item]

    return total_sum

# Пример использования
# text = """Статистика за 127д 21ч 51мин:
# Использовано трафика: 4005,58 Мбайт
# Сэкономлено трафика: 27368,91 Мбайт
# Получено опыта: 2274444381
# Выбито с ботов: 3492726 NV
# Заработано на рыбалке: 0 NV
# Найдены вещи:
# Большое странное зелье (4902 шт.)
# Горные травы (3893 шт.)
# Дар Иланы (2 шт.)
# Закрытое кулачное нападение (4797 шт.)
# Клок волос (526 шт.)
# Клык (4334 шт.)
# Крысиный хвост
# Кулачное нападение (4807 шт.)
# Луговые травы (1459 шт.)
# Малый рунный камень (11 шт.)
# Обрывок чертежей копья I
# Оскверненный Посох Друида
# Свиток Берсерка (97 шт.)
# Свиток Величия
# Свиток Обнаружения (240 шт.)
# Свиток Удар Ярости (3 шт.)
# Свиток закрытого нападения (3743 шт.)
# Свиток каменной кожи (266 шт.)
# Странное зелье
# Телепорт (267 шт.)
# Тёмный Контракт
# Целебные травы (262 шт.)
# Экзотические специи (1111 шт.)"""

text = """Статистика за 23ч 58мин:
Использовано трафика: 46,61 Мбайт
Сэкономлено трафика: 277,12 Мбайт
Получено опыта: 19239623
Выбито с ботов: 26023 NV
Заработано на рыбалке: 0 NV
Найдены вещи:
Большое странное зелье (67 шт.)
Горные травы (38 шт.)
Дар Иланы (3 шт.)
Клык (56 шт.)
Кулачное нападение (34 шт.)
Луговые травы (14 шт.)
Малый рунный камень (4 шт.)
Свиток Берсерка (41 шт.)
Свиток Обнаружения
Свиток закрытого нападения (32 шт.)
Свиток каменной кожи (2 шт.)
Телепорт (2 шт.)
Целебные травы (5 шт.)
Экзотические специи (12 шт.)"""


# Получаем результаты
result, time_spent, experience = parse_statistics(text)
# print("Результаты:", result)
print("Потраченное время:", time_spent)
print("Заработанный опыт:", experience)

# Рассчитываем итоговую сумму
prices = {
    "Большое странное зелье": 200,
    "Горные травы": 160,
    # "Дар Иланы": 1000,
    "Клык": 35,  # Это значение не будет использовано
    "Кулачное нападение": 300,
    "Луговые травы": 100,
    # "Малый рунный камень": 300,
    # "Свиток Берсерка": 200,
    # "Свиток Обнаружения": 100,
    "Свиток закрытого нападения": 180,
    # "Свиток каменной кожи": 120,
    # "Телепорт": 120,
    "Целебные травы": 100,
    "Экзотические специи": 4500
}

# Расчёт общей суммы, исключая "Клык"
total = calculate_total(result, prices)
print("Итоговая сумма:", total,"NV")
